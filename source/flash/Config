REQUIRES Driver
REQUIRES Grid
REQUIRES physics/Hydro
REQUIRES physics/Gravity/GravityMain/Poisson/Multigrid
REQUIRES physics/sourceTerms/Flame
REQUIRES physics/sourceTerms/Flame/FlameEffects/BurnParametric

REQUESTS physics/sourceTerms/Flame/FlameSpeed/BuoyancyCompensation/CONe/TFI
# override unit default
PARAMETER fl_fsUseTFI BOOLEAN true

IF withParticles
   PARTICLETYPE passive INITMETHOD with_density MAPMETHOD weighted ADVMETHOD rungekutta
   REQUIRES Particles/ParticlesMain
   REQUIRES Particles/ParticlesInitialization/WithDensity/CellMassBins
   REQUIRES Particles/ParticlesMapping/meshWeighting/CIC
   REQUESTS IO/IOMain/
   REQUESTS IO/IOParticles
ENDIF

#
# progenitor
#

PARAMETER     initialWDpFile        STRING   "cc_7e8_linear_wd_plain.dat"
PARAMETER     initialWDsFile        STRING   "cc_7e8_linear_wd_plain.dat"

#
# convection field
#
# the star's temperature structure (adiabatic) is used to determine
# the run of the rms velocity
#
D sim_smooth_level  number of refinement levels to smooth the turbulence field
D sim_vrms_center   magnitude of rms velocity at center
D sim_vrms_Tc       central Tc of initial WD
D sim_vrms_T0       background temperature of star outside convection zone

PARAMETER    sim_smooth_level  INTEGER     0
PARAMETER    sim_vrms_center      REAL     100e5
PARAMETER    sim_vrms_Tc          REAL     7e8
PARAMETER    sim_vrms_T0          REAL     1e8

D sim_turbfield_filename  file from which the initial turbulent field is to be read
D sim_read_turbfield      boolean to read in initial turbulence file
PARAMETER     sim_turbfield_filename  STRING  "turb_vel_field.hdf5"
PARAMETER     sim_read_turbfield     BOOLEAN  FALSE

D sim_turbfield_xxxx define bounding box into which the turbulence
D &                  field is mapped
PARAMETER     sim_turbfield_xmin REAL     -2048e5
PARAMETER     sim_turbfield_xmax REAL     2048e5
PARAMETER     sim_turbfield_ymin REAL     -2048e5
PARAMETER     sim_turbfield_ymax REAL     2048e5
PARAMETER     sim_turbfield_zmin REAL     -2048e5
PARAMETER     sim_turbfield_zmax REAL     2048e5

#
# period of WD binary
#

PARAMETER     binary_period         REAL     40.0

#
# ambient medium outside star
#
# dens_fluff = density of the fluff
# temp_fluff = temperature of the fluff
# xc12_fluff = c12 mass fraction of the fluff
# xo16_fluff = o16 mass fraction of the fluff

PARAMETER     dens_fluff         REAL     1.0e-3
PARAMETER     temp_fluff         REAL     3.0e7
PARAMETER     xc12_fluff         REAL     0.5e0
PARAMETER     xne22_fluff        REAL     0.0e0

#
# ignition
#

PARAMETER     ignite             BOOLEAN  FALSE
PARAMETER     x_match            REAL     0.e0
PARAMETER     y_match            REAL     0.e0
PARAMETER     z_match            REAL     0.e0
PARAMETER     r_match            REAL     0.e0

PARAMETER     ignition_file      BOOLEAN  FALSE
PARAMETER     ignition_file_name STRING   "ignition_points.dat"

D ignitionMPole   use multipole ignition surface perturbation
PARAMETER     ignMPole      BOOLEAN  FALSE
PARAMETER     ignMPoleA     REAL     0.3e7
PARAMETER     ignMPoleMinL  INTEGER  4
PARAMETER     ignMPoleMaxL  INTEGER  16
PARAMETER     ignMPoleSeed  INTEGER  169332

D ignSin    use a sinusoidal ignition surface purturbation
D & not currently implemented
PARAMETER     ignSin        BOOLEAN FALSE
PARAMETER     ignSinN       REAL    6.0
PARAMETER     ignSinA       REAL    30e5

#
# custom refinement criteria
#

D refFluffDensThresh refinement threshold for derefinement in Fluff
D & below this density a maximum refinement level of refFluffLevel is enforced
D refFluffMargin     Padding margin for thresholding (in fractional units)
D & in margin above threshold ...
D refFluffLevel      Maximum refinement level of fluff

PARAMETER     refFluffDensThresh   REAL      1.e5
PARAMETER     refFluffMargin       REAL      0.2
PARAMETER     refFluffLevel        INTEGER   1

PARAMETER     refNogenEnucThresh   REAL      1.e16
PARAMETER     refNogenFldtThresh   REAL      0.02
PARAMETER     refNogenMargin       REAL      0.5
PARAMETER     refNogenLevel        INTEGER   2

PARAMETER     refCentRegionDist    REAL      500e5
PARAMETER     refCentRegionLevel   INTEGER   1

# The variable below is for debugging and (currently) also for
# refinement criteria - although the latter use will hopefully
# go away soon, and then so can the variable or GRIDVAR.
# Use either the GRIDVAR or VARIABLE statement, not both.
# Only when using VARIABLE will the enuc output in checkpoint
# and plotfiles be correct even if there was a refinement
# change just before the files are written.
# Only when using VARIABLE will the burning rate and burning
# area be shown in flash.dat output.
#
# Use with ft_debug=true

# this variable saves the flame speed for debugging and can be removed if desired
VARIABLE fspd

PARTICLEPROP	dens		REAL
PARTICLEMAP	TO dens		FROM VARIABLE dens
PARTICLEPROP	temp		REAL
PARTICLEMAP	TO temp		FROM VARIABLE temp
PARTICLEPROP	pres		REAL
PARTICLEMAP	TO pres		FROM VARIABLE pres
PARTICLEPROP	flam		REAL
PARTICLEMAP	TO flam		FROM MASS_SCALAR FLAM
PARTICLEPROP	phfa		REAL
PARTICLEMAP	TO phfa		FROM MASS_SCALAR phfa
PARTICLEPROP	phaq		REAL
PARTICLEMAP	TO phaq		FROM MASS_SCALAR phaq
PARTICLEPROP	phqn		REAL
PARTICLEMAP	TO phqn		FROM MASS_SCALAR phqn
PARTICLEPROP	ye		REAL
PARTICLEMAP	TO ye		FROM MASS_SCALAR ye

DATAFILES cc_7e8_linear_wd_plain.dat


# these override some unit defaults
PARAMETER useBurn BOOLEAN true
PARAMETER bn_thermalReact BOOLEAN false
